---
title: |
 | Exploration 9: Engaging with Alternative Explanations with Other Design Strategies: 
 | The Regression Discontinuity Design
author: 'Jake Bowers'
date: '`r format(Sys.Date(), "%B %d, %Y")`'
bibliography: classbib.bib
fontsize: 10pt
geometry: margin=1in
mainfont: "Crimson Text"
graphics: yes
output:
  html_document:
    fig_caption: yes
    fig_height: 4
    fig_width: 4
  pdf_document:
    latex_engine: xelatex
    fig_caption: yes
    fig_height: 4
    fig_width: 4
---

<!-- Make this document using library(rmarkdown); render("exploration1.Rmd") -->
\input{mytexsymbols}


```{r include=FALSE, cache=FALSE}
# Some customization.  You can alter or delete as desired (if you know what you are doing).
# knitr settings to control how R chunks work.

## To make the html file do
## render("exploration1.Rmd",output_format=html_document(fig_retina=FALSE))
## To make the pdf file do
## render("exploration1.Rmd",output_format=pdf_document())

require(knitr)
opts_chunk$set(
  tidy = FALSE, # display code as typed
  size = "small", # slightly smaller font for code
  echo = TRUE,
  results = "markup",
  strip.white = TRUE,
  fig.path = "figs/fig",
  cache = FALSE,
  highlight = TRUE,
  width.cutoff = 132,
  size = "footnotesize",
  out.width = ".9\\textwidth",
  fig.retina = FALSE,
  message = FALSE,
  comment = NA
)

if (!file.exists("figs")) dir.create("figs")

options(
  SweaveHooks = list(
    fig = function() {
      par(
        mar = c(3.5, 3, 1.1, 0),
        pty = "s",
        mgp = c(1.5, 0.5, 0),
        oma = c(0, 0, 0, 0)
      )
    },
    echo = function() {
      options(continue = " ") ## Don't show "+" prompts,
      options(prompt = " ")
    }
  ),
  digits = 4,
  scipen = 8,
  width = 132
)
options(error = function() {
  options(prompt = "> ", continue = "+ ")
  NULL
})
```


"I just read something super scary: 'The empirical evidence shows that larger
transfers increase observed corruption and reduce the average education of
candidates for mayor.'! That is what @brollo2013political say happens in
Brasil: that money given to cities to help the poor basically increased
corruption! I'm writing now because I'm very confused: I immediately began to
think about the ways in which municipalities that receive money may differ from
municipalities that do not receive such funds. Might the money be aiming to
reduce corruption? (i.e. be caused by corruption?) Or might corruption be more
prevalent in places with citizens with less capacity (i.e. poorer places,
places more in need of federal funding)? That is, it was easy for me to come up
with alternative explanations for their finding. However, those authors told me
that they had taken care of all extant alternative explanations. And I said,
'Oh yeah? I bet you are just relying on functional form assumptions and
probably have terrible influential point problems that are both completely
misleading us all.' And they said, 'Not at all. We are using a regression
discontinuity design and so we don't have to control for covariates.'"

"Then I did a some hunting around, but mainly managed to confused myself. Can
you explain why they think that they don't have to control for covariates? They
must have to make some assumptions, right? I mean, this idea that you can find
some clever discontinuity feels a lot like the instrumental variable approach.
Moreover, I also ran across @cattaneo2016interpreting's reanalysis of this
paper. Can you explain their general insight and difference from the original
analysis? Can you show me that the municipalities in the areas chosen for focus
around the discontinuities have covariate balance? If they don't, what window
should we choose? Or should we do some matching in addition to window choosing?
How might you calculate a treatment effect in this case?"

Since I keep my data setup work in a different file from my analysis work
(following @bowers2016future), I'm including it here. As you can see, I merged
two files together.

> datasetup.R

```{r, cache=TRUE}
library(readstata13)
dat <- read.dta13("http://jakebowers.org/Data/CattaneoEtAl2016/data-population-example.dta", convert.factors = FALSE)
attr(dat, "var.labels")
```

```{r, cache=TRUE}
brollodat <- read.dta13("http://jakebowers.org/Data/CattaneoEtAl2016/AER_smallsample.dta", convert.factors = FALSE)
stopifnot(all.equal(dat$x, brollodat$pop))
length(unique(dat$x))
length(unique(brollodat$pop))
## Restrict attention to only municipalities with unique population numbers so that we can use the covariates from the Brollo et al paper.

uniqdat <- dat[!duplicated(dat$x), ]
uniqbrollodat <- brollodat[!duplicated(brollodat$pop), ]
stopifnot(all.equal(uniqdat$x, uniqbrollodat$pop))

## Merge the covariates from the Brollo et al paper onto the original dataset
## bigdat <- merge(uniqdat,uniqbrollodat,by.x="x",by.y="pop",all=TRUE)
library(dplyr)
## dplyr functions are often faster than base R functions
uniqdat$pop <- uniqdat$x ## to allow both data frames to have same key name
stopifnot(intersect(names(uniqdat), names(uniqbrollodat)) == "pop")
bigdat <- inner_join(uniqdat, uniqbrollodat, by = "pop")
stopifnot(nrow(bigdat) == nrow(uniqdat))
stopifnot(nrow(bigdat) == nrow(uniqbrollodat))
stopifnot(all.equal(bigdat$pop, bigdat$x))
save(bigdat, file = "bigdat.rda")
```


> analysis.Rmd

> Here are some of my notes:  Step 1: Assess window size. Maybe DCdensity in
> package rdd givn sec 2.3 in Sales and Hansen?? Or xBalance? Is our running
> variable discrete? Yes in fact. No in principle. Right? I don't know if
> disbursements were chunky or continuous at the federal level. Or maybe better
> specification test style approach of Sales and Hansen ion sec 3.2 sec 4?? So
> confusing!

```{r}
rm(list = ls()) ## removes all existing objects in the working memory
load("bigdat.rda")
## Treatment indicator for first discontinuiity of 10189
## Other discontinuities: 13585, 16981, 23773, 30565, 37356, 44148
bigdat$z10189 <- as.numeric(bigdat$x >= 10189)
mean(bigdat$y[bigdat$z10189 == 1 & bigdat$cutoff_10189 == 1]) - mean(bigdat$y[bigdat$z10189 == 0 & bigdat$cutoff_10189 == 1])
lm(y ~ z10189, data = bigdat, subset = cutoff_10189 == 1)
```



# References

